# Agora que temos uma prepared statement para inserir uma pessoa, vamos refatorar o endpoint POST / para que ele consiga realizar o cadastro de uma pessoa no banco de dados:

// src/routes/peopleRoutes.js

// const express = require('express');
const peopleDB = require('../db/peopleDB');

// const router = express.Router();

router.post('/', async (req, res) => {
  const person = req.body;
  try {
    const [result] = await peopleDB.insert(person);
    res.status(201).json({
      message: `Pessoa cadastrada com sucesso com o id ${result.insertId}` });
  } catch (err) {
    console.log(err);
    res.status(500).json({ message: 'Ocorreu um erro ao cadastrar uma pessoa' });
  }
});
// module.exports = router;


> No código acima, importamos o módulo de src/db/peopleDB.js. No endpoint POST /, criamos a variável person para receber os dados da pessoa a ser cadastrada.

Em seguida, temos um bloco try/catch responsável por responder a requisição. Dentro do bloco try é utilizada a função insert passando como parâmetro os dados recebidos na requisição e, por conta do await, aguardamos a inserção da pessoa no banco de dados.

Se a inserção ocorrer com sucesso, é retornada uma resposta com o status 201 e com um JSON contendo uma mensagem indicando o sucesso da operação.

Em caso de erro, ele é impresso no terminal via console.log e é retornada uma resposta com o status 500 e com um JSON contendo uma mensagem indicando a falha na operação.



# Nesse ponto
 podemos iniciar a nossa aplicação com o comando npm start e realizar uma requisição do tipo POST com o Thunder para a nossa API, passando o seguinte JSON:

{
  "firstName": "Luke",
  "lastName": "Skywalker",
  "email": "luke.skywalker@trybe.com",
  "phone": "851 678 4453"
}


# Nesse momento teremos a seguinte estrutura de arquivos e diretórios no projeto:
.
└── trybecash-api/
    ├── src/
    │   ├── db/
    │   │   ├── connection.js
    │   │   └── peopleDB.js
    │   ├── routes/
    │   │   └── peopleRoutes.js
    │   ├── app.js
    │   └── server.js
    ├── tests/
    │   └── integration/
    │       └── people.test.js
    ├── docker-compose.yaml
    ├── Dockerfile
    ├── package.json
    └── trybecash_script.sql




























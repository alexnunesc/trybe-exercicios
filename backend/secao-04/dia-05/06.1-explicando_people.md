Com esse c√≥digo, fazemos as importa√ß√µes necess√°rias para realizar os testes de integra√ß√£o.

Em seguida s√£o criadas as vari√°veis app e connection que fazem refer√™ncia aos m√≥dulos src/app.js e src/db/connection.js. Teremos apenas um describe que agrupar√° os testes relacionados ao endpoint people.

Dentro do describe criado, temos um caso de teste (declara√ß√£o it) que realiza duas tarefas:

Cria um stub com o sinon na fun√ß√£o execute de connection, de maneira que quando essa fun√ß√£o for chamada no teste, ela retornar√° um array contendo um objeto com a chave insertId com o valor 42.

Uma requisi√ß√£o ao endpoint POST /people passando um JSON com os dados da pessoa a ser cadastrada no corpo da requisi√ß√£o.

‚ö†Ô∏è Aten√ß√£o: o fato de estarmos colocando um objeto dentro de um array nos testes de integra√ß√£o √© para garantir que o retorno do stub tenha o mesmo formato do retorno das fun√ß√µes do mysql2.

Tamb√©m foi adicionado um afterEach ap√≥s a declara√ß√£o it, que desfaz o stub criado, fazendo com que o m√©todo execute de connection se comporte conforme nossa implementa√ß√£o.

Voc√™ deve estar se perguntando o seguinte: por que estamos criando um stub no m√©todo execute de connection? ü§î

N√≥s temos acesso ao m√©todo execute atrav√©s da biblioteca mysql2, que possui seus testes de integra√ß√£o e testes unit√°rios. Como a biblioteca mysql2 realiza os testes nas fun√ß√µes que ela disponibiliza, podemos assumir em nossos testes que, da chamada da fun√ß√£o connection.execute() em diante, tudo est√° sendo testado!

üëÄ De olho na dica: caso tenha curiosidade em saber como s√£o os testes da biblioteca mysql2, acesse a pasta tests do github da biblioteca.

Em resumo: s√≥ precisamos testar o comportamento da nossa aplica√ß√£o at√© a chamada da fun√ß√£o connection.execute() (que criamos o mock), que retornar√° um resultado conhecido e, de posse desse resultado, verificar√° se a aplica√ß√£o gera a resposta apropriada.

‚ö†Ô∏è Aten√ß√£o: essa premissa √© v√°lida para qualquer biblioteca que estivermos utilizando em nossa aplica√ß√£o e n√£o apenas para mysql2. Teste de software √© uma boa pr√°tica de desenvolvimento, principalmente em bibliotecas escritas pela comunidade. Logo, n√£o precisamos testar o que j√° est√° testado!